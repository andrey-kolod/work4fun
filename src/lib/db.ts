// src/lib/db.ts
import { PrismaClient } from '@prisma/client';

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;

export default prisma;

// –ö–û–ú–ú–ï–ù–¢–´

// // src/lib/db.ts
// /**
//  * üóÑÔ∏è –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ë–ê–ó–ï –î–ê–ù–ù–´–•
//  *
//  * –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º Prisma Client –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.
//  * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Singleton –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
//  * –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Hot Reload).
//  */

// // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º PrismaClient –∏–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
// // –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `npx prisma generate` —Å–æ–∑–¥–∞–µ—Ç—Å—è @prisma/client
// // —Å TypeScript —Ç–∏–ø–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—à–µ–π —Å—Ö–µ–º—ã –ë–î
// import { PrismaClient } from '@prisma/client';

// /**
//  * üåç –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ü–ï–†–ï–ú–ï–ù–ù–ê–Ø –î–õ–Ø DEVELOPMENT
//  *
//  * –í development —Ä–µ–∂–∏–º–µ –ø—Ä–∏ Hot Reload (–±—ã—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ) –º–æ–¥—É–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è.
//  * –ë–µ–∑ —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –∫–∞–∂–¥—ã–π Hot Reload —Å–æ–∑–¥–∞–≤–∞–ª –±—ã –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Prisma Client,
//  * —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –±—ã –∫:
//  * - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º –∫ –ë–î
//  * - –£—Ç–µ—á–∫–∞–º –ø–∞–º—è—Ç–∏
//  * - –û—à–∏–±–∫–µ "Too many connections"
//  *
//  * –†–µ—à–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º Prisma Client –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (globalThis),
//  * –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ Hot Reload.
//  */
// const globalForPrisma = globalThis as unknown as {
//   // –¢–∏–ø–∏–∑–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
//   // prisma –º–æ–∂–µ—Ç –±—ã—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º PrismaClient –∏–ª–∏ undefined (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
//   prisma: PrismaClient | undefined;
// };

// /**
//  * üöÄ –°–û–ó–î–ê–ù–ò–ï/–ü–û–õ–£–ß–ï–ù–ò–ï –≠–ö–ó–ï–ú–ü–õ–Ø–†–ê PRISMA CLIENT
//  *
//  * –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä ?? (Nullish Coalescing):
//  * - –ï—Å–ª–∏ globalForPrisma.prisma —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
//  * - –ï—Å–ª–∏ undefined ‚Üí —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
//  *
//  * –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –≤ development —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä,
//  * –∞ –≤ production —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤–∞–∂–Ω–æ –¥–ª—è serverless).
//  */
// export const prisma = globalForPrisma.prisma ?? new PrismaClient();

// /**
//  * üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –í –ì–õ–û–ë–ê–õ–¨–ù–£–Æ –û–ë–õ–ê–°–¢–¨ (–¢–û–õ–¨–ö–û –î–õ–Ø DEVELOPMENT)
//  *
//  * –í production —Ä–µ–∂–∏–º–µ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ globalThis, –ø–æ—Ç–æ–º—É —á—Ç–æ:
//  * - –í serverless —Ñ—É–Ω–∫—Ü–∏—è—Ö (Vercel/Lambda) –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
//  * - –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
//  * - –õ—É—á—à–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
//  *
//  * process.env.NODE_ENV –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Next.js:
//  * - 'development' –ø—Ä–∏ `npm run dev`
//  * - 'production' –ø—Ä–∏ `npm run build && npm start`
//  */
// if (process.env.NODE_ENV !== 'production') {
//   globalForPrisma.prisma = prisma;
// }

// /**
//  * üéØ –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –í –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:
//  *
//  * // –í API route (app/api/users/route.ts)
//  * import { prisma } from '@/lib/db';
//  *
//  * export async function GET() {
//  *   try {
//  *     const users = await prisma.user.findMany({
//  *       where: { isActive: true },
//  *       include: { group: true }
//  *     });
//  *     return Response.json(users);
//  *   } catch (error) {
//  *     return Response.json({ error: 'Database error' }, { status: 500 });
//  *   }
//  * }
//  *
//  * // –í Server Component (app/users/page.tsx)
//  * import { prisma } from '@/lib/db';
//  *
//  * export default async function UsersPage() {
//  *   const users = await prisma.user.findMany();
//  *   return <div>{/* render users */}</div>;
//  * }
//  */

// /**
//  * ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:
//  *
//  * 1. –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–π PrismaClient –≤ –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ:
//  *    ‚ùå const prisma = new PrismaClient(); // –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø!
//  *
//  * 2. –í—Å–µ–≥–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π –≥–æ—Ç–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä:
//  *    ‚úÖ import { prisma } from '@/lib/db';
//  *
//  * 3. Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—É–ª–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
//  * 4. –í production –Ω–∞ serverless-—Ö–æ—Å—Ç–∏–Ω–≥–∞—Ö (Vercel) –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
//  *    –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä, –Ω–æ –ø—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
//  */

// /**
//  * üîß –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –ü–†–ò –°–û–ó–î–ê–ù–ò–ò NEW PRISMACLIENT():
//  *
//  * 1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ö–µ–º—É –ë–î –∏–∑ prisma/schema.prisma
//  * 2. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É—è DATABASE_URL –∏–∑ .env
//  * 3. –°–æ–∑–¥–∞–µ—Ç –ø—É–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏)
//  * 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç TypeScript-—Ç–∏–ø—ã –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
//  * 5. –í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ development —Ä–µ–∂–∏–º–µ
//  *
//  * üìä –î–û–°–¢–£–ü–ù–´–ï –ú–ï–¢–û–î–´ (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏–∑ —Å—Ö–µ–º—ã):
//  * - prisma.user.findMany()      // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
//  * - prisma.task.create()        // –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
//  * - prisma.project.update()     // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
//  * - prisma.comment.delete()     // –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
//  * - –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...
//  */

// // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Prisma Client –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
// export default prisma;
